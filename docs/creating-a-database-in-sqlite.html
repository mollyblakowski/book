<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Creating a database in SQLite | Investigating industrial sources of heavy metal pollution to the Great Salt Lake playa</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Creating a database in SQLite | Investigating industrial sources of heavy metal pollution to the Great Salt Lake playa" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Creating a database in SQLite | Investigating industrial sources of heavy metal pollution to the Great Salt Lake playa" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Molly Blakowski" />


<meta name="date" content="2021-04-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="plotting-data-with-ggplot.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">WILD 6900 Final Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#project-goals"><i class="fa fa-check"></i><b>1.1</b> Project goals</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#project-outline"><i class="fa fa-check"></i><b>1.2</b> Project outline</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#project-background"><i class="fa fa-check"></i><b>1.3</b> Project background</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cleaning-raw-data-with-tidyverse.html"><a href="cleaning-raw-data-with-tidyverse.html"><i class="fa fa-check"></i><b>2</b> Cleaning raw data with tidyverse</a></li>
<li class="chapter" data-level="3" data-path="plotting-data-with-ggplot.html"><a href="plotting-data-with-ggplot.html"><i class="fa fa-check"></i><b>3</b> Plotting data with ggplot</a></li>
<li class="chapter" data-level="4" data-path="creating-a-database-in-sqlite.html"><a href="creating-a-database-in-sqlite.html"><i class="fa fa-check"></i><b>4</b> Creating a database in SQLite</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Investigating industrial sources of heavy metal pollution to the Great Salt Lake playa</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="creating-a-database-in-sqlite" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Creating a database in SQLite</h1>
<p>Here, I present the steps I have taken to build my metal_sources database in SQLite. After my comprehensive exams are finally over, I will populate this database with data from all other Tl isotope studies that have been conducted on metal sources and environmental samples (thankfully there are very few of these). For now, here is what I did to create the database for our previous assignment.</p>
<hr />
<div class="figure" style="text-align: center"><span id="fig:nice-fig"></span>
<img src="metal-sources_schema.png" alt="Figure illustrating metal_sources database schema." width="80%" />
<p class="caption">
Figure 4.1: Figure illustrating metal_sources database schema.
</p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install packages</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">install.packages</span>(<span class="st">&quot;RSQLite&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">install.packages</span>(<span class="st">&quot;DBI&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># load DBI package</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(DBI)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#  establish database connection</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">metal_sources_db &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> RSQLite<span class="op">::</span><span class="kw">SQLite</span>(), <span class="st">&quot;/Users/mollyblakowski/Documents/professional/PhD/research/metal_sources/data/metal_sources.db&quot;</span>)</a></code></pre></div>
<p>My database has 8 tables. The first tables I need to create are sites and projects because they don’t have foreign keys. These two tables house data associated with where samples were collected and with what project they are associated - specifically, is the data from my project, a collaborator’s project, or a project from the literature.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># create sites and projects tables</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE sites (</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">site_id char(3) NOT NULL PRIMARY KEY,</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">site_name varchar(50),</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">latitude double,</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">longitude double</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="st">);&quot;</span>)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE projects (</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">project_id char(3) NOT NULL PRIMARY KEY,</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="st">contact_first varchar(50),</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="st">contact_last varchar(50),</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">doi varchar(50)</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">);&quot;</span>)</a></code></pre></div>
<p>Next, I can create the collections table, which stores information about when sample bottles were deployed and collected from sites. The reason this goes next is that I can’t make the samples table without it.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># create collections table</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE collections (</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">collection_id INTEGER PRIMARY KEY,</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">deploy_date text,</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">collect_date text,</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">period_id varchar(20),</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">site_id char(3),</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">FOREIGN KEY (site_id) REFERENCES sites(site_id)</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">);&quot;</span>)</a></code></pre></div>
<p>The samples table contains information on the sample mass and the dimensions of the sampler that are needed to calculate flux. It is connected to collections and sites via collection_id, as as well to projects via project_id.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># create samples table</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE samples (</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">sample_id INTEGER PRIMARY KEY,</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">collection_id varchar(5),</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">mass_g float,</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">inlet_area_cm2 float,</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">inlet_area_m2 float,</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="st">project_id  char(3),</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">FOREIGN KEY (collection_id) REFERENCES collections(collection_id),</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="st">FOREIGN KEY (project_id) REFERENCES projects(project_id)</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="st">);&quot;</span>)</a></code></pre></div>
<p>The remaining tables are here to store results from my work in the lab.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># create grain_size table</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE grain_size (</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">grain_size_id INTEGER PRIMARY KEY AUTOINCREMENT,</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">sample_id varchar(5),</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">median_grain_size_um float,</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">mean_grain_size_um float,</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">min_size_um float,</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">max_size_um float,</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="st">FOREIGN KEY (sample_id) REFERENCES samples(sample_id)</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="st">);&quot;</span>)</a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="co"># create isotopes table</span></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE isotopes (</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="st">isotopes_id INTEGER PRIMARY KEY AUTOINCREMENT,</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="st">sample_id varchar(5),</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="st">epsilon_tl float,</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="st">epsilon_tl_error float,</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="st">FOREIGN KEY (sample_id) REFERENCES samples(sample_id)</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="st">);&quot;</span>)</a>
<a class="sourceLine" id="cb5-22" data-line-number="22"></a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co"># create minerals table</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE minerals (</span></a>
<a class="sourceLine" id="cb5-26" data-line-number="26"><span class="st">minerals_id INTEGER PRIMARY KEY AUTOINCREMENT,</span></a>
<a class="sourceLine" id="cb5-27" data-line-number="27"><span class="st">sample_id varchar(5),</span></a>
<a class="sourceLine" id="cb5-28" data-line-number="28"><span class="st">quartz_percent float,</span></a>
<a class="sourceLine" id="cb5-29" data-line-number="29"><span class="st">calcite_percent float,</span></a>
<a class="sourceLine" id="cb5-30" data-line-number="30"><span class="st">halite_percent float,</span></a>
<a class="sourceLine" id="cb5-31" data-line-number="31"><span class="st">chlorite_percent float,</span></a>
<a class="sourceLine" id="cb5-32" data-line-number="32"><span class="st">kaolinite_percent float,</span></a>
<a class="sourceLine" id="cb5-33" data-line-number="33"><span class="st">aragonite_percent float,</span></a>
<a class="sourceLine" id="cb5-34" data-line-number="34"><span class="st">andesine_percent float,</span></a>
<a class="sourceLine" id="cb5-35" data-line-number="35"><span class="st">bytownite_percent float,</span></a>
<a class="sourceLine" id="cb5-36" data-line-number="36"><span class="st">dolomite_percent float,</span></a>
<a class="sourceLine" id="cb5-37" data-line-number="37"><span class="st">gypsum_percent float,</span></a>
<a class="sourceLine" id="cb5-38" data-line-number="38"><span class="st">illite_percent float,</span></a>
<a class="sourceLine" id="cb5-39" data-line-number="39"><span class="st">oligoclase_percent float,</span></a>
<a class="sourceLine" id="cb5-40" data-line-number="40"><span class="st">plagioclase_percent float,</span></a>
<a class="sourceLine" id="cb5-41" data-line-number="41"><span class="st">FOREIGN KEY (sample_id) REFERENCES samples(sample_id)</span></a>
<a class="sourceLine" id="cb5-42" data-line-number="42"><span class="st">);&quot;</span>)</a>
<a class="sourceLine" id="cb5-43" data-line-number="43"></a>
<a class="sourceLine" id="cb5-44" data-line-number="44"><span class="co"># create elements table</span></a>
<a class="sourceLine" id="cb5-45" data-line-number="45"></a>
<a class="sourceLine" id="cb5-46" data-line-number="46"><span class="kw">dbExecute</span>(metal_sources_db, <span class="st">&quot;CREATE TABLE elements (</span></a>
<a class="sourceLine" id="cb5-47" data-line-number="47"><span class="st">elements_id INTEGER PRIMARY KEY AUTOINCREMENT,</span></a>
<a class="sourceLine" id="cb5-48" data-line-number="48"><span class="st">sample_id varchar(5),</span></a>
<a class="sourceLine" id="cb5-49" data-line-number="49"><span class="st">as_ppm float,</span></a>
<a class="sourceLine" id="cb5-50" data-line-number="50"><span class="st">cd_ppm float,</span></a>
<a class="sourceLine" id="cb5-51" data-line-number="51"><span class="st">co_ppm float,</span></a>
<a class="sourceLine" id="cb5-52" data-line-number="52"><span class="st">cr_ppm float,</span></a>
<a class="sourceLine" id="cb5-53" data-line-number="53"><span class="st">cu_ppm float,</span></a>
<a class="sourceLine" id="cb5-54" data-line-number="54"><span class="st">pb_ppm float,</span></a>
<a class="sourceLine" id="cb5-55" data-line-number="55"><span class="st">tl_ppm float,</span></a>
<a class="sourceLine" id="cb5-56" data-line-number="56"><span class="st">zr_ppm float,</span></a>
<a class="sourceLine" id="cb5-57" data-line-number="57"><span class="st">FOREIGN KEY (sample_id) REFERENCES samples(sample_id)</span></a>
<a class="sourceLine" id="cb5-58" data-line-number="58"><span class="st">);&quot;</span>)</a></code></pre></div>
<p>Wow, I made a lot of typos while setting this up. But I’m done! Well, I still need to import my data into these tables, and after I do that, I also need to create temp tables for the results tables as per the directions in our course materials.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="plotting-data-with-ggplot.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
